"use strict";(self.webpackChunk_lexical_website=self.webpackChunk_lexical_website||[]).push([[4952],{876:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>g});var o=n(2784);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},s=Object.keys(e);for(o=0;o<s.length;o++)n=s[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)n=s[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=o.createContext({}),l=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=l(e.components);return o.createElement(c.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},h=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,s=e.originalType,c=e.parentName,p=a(e,["components","mdxType","originalType","parentName"]),u=l(n),h=i,g=u["".concat(c,".").concat(h)]||u[h]||d[h]||s;return n?o.createElement(g,r(r({ref:t},p),{},{components:n})):o.createElement(g,r({ref:t},p))}));function g(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var s=n.length,r=new Array(s);r[0]=h;var a={};for(var c in t)hasOwnProperty.call(t,c)&&(a[c]=t[c]);a.originalType=e,a[u]="string"==typeof e?e:i,r[1]=a;for(var l=2;l<s;l++)r[l]=n[l];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}h.displayName="MDXCreateElement"},7009:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>s,metadata:()=>a,toc:()=>l});var o=n(7896),i=(n(2784),n(876));const s={},r="Lexical's useHistory adds support for Undo and Redo",a={unversionedId:"concepts/history",id:"concepts/history",title:"Lexical's useHistory adds support for Undo and Redo",description:"Part of undo and redo requires supporting coalescing of certain dynamic operations such as continuous typing.",source:"@site/docs/concepts/history.md",sourceDirName:"concepts",slug:"/concepts/history",permalink:"/lexical/docs/concepts/history",draft:!1,editUrl:"https://github.com/QubitPi/lexical/tree/main/packages/lexical-website/docs/concepts/history.md",tags:[],version:"current",frontMatter:{}},c={},l=[],p={toc:l},u="wrapper";function d(e){let{components:t,...n}=e;return(0,i.kt)(u,(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"lexicals-usehistory-adds-support-for-undo-and-redo"},"Lexical's useHistory adds support for Undo and Redo"),(0,i.kt)("p",null,"Part of undo and redo requires supporting coalescing of certain dynamic operations such as continuous typing.\nThe below provides background information regarding the continuous typing undo coalescing feature."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Undo Coalescing of Typed Text")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"TL;DR"),"\nWhen working with text editors, users expect a well polished undo experience. A key part of this is a smooth, well thought out workflow when undoing continuous typing events. For this post, strict typing events may be limited to typing characters, backspacing and forward deleting. Users generally expect that continuous typing should fully undo with a single undo gesture and that they don\u2019t require separate undo gestures for each character.\nThe algorithm that covers this is \u201cundo coalescing of typed text\u201d and there\u2019s a certain degree of nuance involved. This post covers that nuance while attempting to avoid prescriptive implementation details."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"What Kind of Edits Require Coalescing?"),"\nAs mentioned above, continuous typing should be coalesced into a single undo action. Continuous typing is a loaded phrase and we\u2019ll get into some details below.\nThere are other types of edits that require undo coalescing such as rapidly resizing an image or rapidly changing the font size of selected text. These latter two examples fall under what might be termed \u201cdynamic operations\u201d and their implementation might vary quite a bit from coalescing of typing."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"What Constitutes Continuous Typing?"),"\nFor the purposes of undo coalescing, continuous typing events are safely limited to these three actions:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Forward typing characters (heads up, composed character typing discussed later)."),(0,i.kt)("li",{parentName:"ol"},"Deleting backwards, e.g. backspace gestures including backspace key presses."),(0,i.kt)("li",{parentName:"ol"},"Forward deletion, e.g. forward delete gestures including Delete key presses.")),(0,i.kt)("p",null,"Any interruption to the above breaks the notion of continuous typing. Note that switching between either of these three actions may itself be considered an interruption of continuous typing or it may not. This ends up being a usability decision. In my opinion, when examining various word processors, switching between these three actions should maintain continuity, because users often make typos or corrections in the flow of typing and therefore would lean towards the whole sequence of typing, backspacing and deleting to be within a single undoable session.\nNote that Google Docs and Quip treat a switch between typing, backspacing and deleting as disruptions to the continuous typing sessions."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Start with Selected Text and Followup with Typing"),"\nLet\u2019s start with some selected text. The user may have selected the text directly, as a result of pasting text or through some other sequence of steps. When followed by continuous typing, the initial selection should be included along with the following typing events as part of a single coalesced undo session."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Timeouts"),"\nText editing is generally a modeless user experience and so just about any event beyond the above typing actions will disrupt continuous typing. The first and foremost is a timeout.\nQuip seems to require continuous typing to occur within 1 second intervals, whereas Google Docs requires about 2 seconds. In my opinion, the timeout may stretch to as long as 3 to 5 seconds. The more time between typing events, the more chance the user has to intentionally input a block of text, a thought or concept.\nThe use of a timeout is not necessarily required, and the amount of time is certainly up for debate. Collaborative co-editing also makes use of timeouts when grouping text that is merged across clients. Longer timeouts tend to make collaboration a smoother, less disruptive experience, because receiving other client input while expressing one\u2019s thoughts tends to be unhelpful.\nImplementers should consider the correct timeout based on their customer expectations and related collaborative features that might share this timeout."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Hard and Soft Returns"),"\nHard returns as generated by pressing the Return key tend to disrupt and thereby reset continuous typing.\nFor Google Docs and Quip, soft returns as generated by pressing shift+Return key do not terminate continuous typing. This makes sense in that the soft return ends text wrap but does not end the paragraph."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Changing Selections and Key Focus"),"\nAny change to the selection by the user should terminate coalescing. This includes:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Arrow gesture navigation."),(0,i.kt)("li",{parentName:"ul"},"Gestures to select a word, a sentence or a paragraph."),(0,i.kt)("li",{parentName:"ul"},"Any other selection change that does not move the blinking caret to the next or previous character by way of the above mentioned typing events.")),(0,i.kt)("p",null,"Additionally, ending keyboard focus on the editing window, including moving focus to another editing window or a different view within the same window should also terminate coalescing. This also includes setting focus to modal popovers, such as, for example, a hyperlink property editor."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Composed Characters"),"\nCharacter composition occurs when typing diacritics, CJK and even emojis. The process usually involves at least these three phases:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Start composition."),(0,i.kt)("li",{parentName:"ul"},"Replace composed text with other text and remain composing. This step may occur many times within a single composition session."),(0,i.kt)("li",{parentName:"ul"},"Stop composition either through accepting the text or canceling the latest input.")),(0,i.kt)("p",null,"Coalescing should terminate at start composition. Replacing composed text should generally be coalesced. Stopping composition may or may not reset coalescing depending upon the implementation. Quip appears to try to coalesce multiple composed characters, but disrupts coalescing when switching between composed and non-composed characters. Google Docs appears to disrupt coalescing more frequently. Both coalesce the text replacements."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Auto Correct, Spelling Corrections and Text Substitutions"),"\nText substitution behaves much like composed characters. When the text is transformed, the coalescing should terminate and the transformed text becomes the first coalesced entry in the next undo session."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Copy & Pasting"),"\nAny actions like copy and paste typically trigger events that are not part of the 3 continuous typing actions described above. So, copy and paste also terminates coalescing."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"In Conclusion"),"\nText undo coalescing greatly improves the usability of undo in that it allows the user to bypass all the intermediate events that went into forming or re-forming text within a paragraph. Given the modeless nature of text editing, limiting continuous typing to strictly three events allows for a robust and clean implementation. Implementers will need tight bottlenecks to trap selection changes, key focus changes as well as changes from collaborative clients. While the above is not complete by any means, I hope readers will find it helpful."))}d.isMDXComponent=!0}}]);