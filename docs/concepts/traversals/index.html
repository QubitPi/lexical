<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-concepts/traversals" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.8.0"><title data-rh=true>Node Traversals with NodeCaret | Lexical</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://lexical.dev/docs/concepts/traversals><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Node Traversals with NodeCaret | Lexical"><meta data-rh=true name=description content="NodeCaret offers a unified and efficient way for traversing the document"><meta data-rh=true property=og:description content="NodeCaret offers a unified and efficient way for traversing the document"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://lexical.dev/docs/concepts/traversals><link data-rh=true rel=alternate href=https://lexical.dev/docs/concepts/traversals hreflang=en><link data-rh=true rel=alternate href=https://lexical.dev/docs/concepts/traversals hreflang=x-default><link data-rh=true rel=preconnect href=https://YRGKJK6OMH-dsn.algolia.net crossorigin=anonymous><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://lexical.dev/docs/concepts/traversals","name":"Node Traversals with NodeCaret","position":1}]}</script><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="Lexical RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="Lexical Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=G-7C6YYBYBBT"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-7C6YYBYBBT",{})</script><link rel=search type=application/opensearchdescription+xml title=Lexical href=/opensearch.xml><link rel=stylesheet href=/assets/css/styles.ae5be95c.css><script src=/assets/js/runtime~main.fcef97d2.js defer></script><script src=/assets/js/main.3229ce63.js defer></script><body class=navigation-with-keyboard><svg xmlns=http://www.w3.org/2000/svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light",e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script>

<div style="display: none; text-align: center; background-color: white; color: black;" id=internaldocs-banner></div><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_G6ar href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/logo.svg alt=Lexical class="themedComponent_DHUr themedComponent--light_DIHH"><img src=/img/logo-dark.svg alt=Lexical class="themedComponent_DHUr themedComponent--dark_Bv2M"></div></a><a href=https://playground.lexical.dev/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">Playground</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/docs/intro>Docs</a><a class="navbar__item navbar__link" href=/docs/api/>API</a><a class="navbar__item navbar__link" href=/community>Community</a><a href=https://facebook.github.io/lexical-ios/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">iOS<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_awgD><use href=#theme-svg-external-link /></svg></a><a class="navbar__item navbar__link" href=/gallery>Gallery</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href=https://github.com/QubitPi/lexical target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_awgD><use href=#theme-svg-external-link /></svg></a><a href=https://github.com/facebook/lexical-ios target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">iOS GitHub<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_awgD><use href=#theme-svg-external-link /></svg></a><div class="toggle_OLSw colorModeToggle_Hg9V"><button class="clean-btn toggleButton_wYmb toggleButtonDisabled_vaDU" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_KEbZ lightToggleIcon_Sxwe"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_KEbZ darkToggleIcon_Yem1"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_KEbZ systemToggleIcon_txm5"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_bmvg><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_UyTV"><div class=docsWrapper_XLvK><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_z1FD" type=button></button><div class=docRoot_HciC><aside class="theme-doc-sidebar-container docSidebarContainer_e5ai"><div class=sidebarViewport_N8x0><div class=sidebar_vJCc><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_qiME"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/intro>Introduction</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs/getting-started/quick-start>Getting Started</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true href=/docs/concepts/editor-state>Concepts</a></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/editor-state>Editor State</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/nodes>Nodes</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/node-replacement>Node Replacement</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/node-state>NodeState</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/key-management>Key Management</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/node-cloning>Node Cloning</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/listeners>Listeners</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/transforms>Node Transforms</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/commands>Commands</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/selection>Selection</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/read-only>Read Mode / Edit Mode</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/history>useHistory</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/serialization>Serialization & Deserialization</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/dom-events>Working with DOM Events</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/docs/concepts/traversals>Node Traversals with NodeCaret</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/updates>Updates</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs/packages/lexical>Packages</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs/react/>React</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs/collaboration/react>Collaboration</a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/faq>FAQ</a></ul></nav><button type=button title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_Ftvb"><svg width=20 height=20 aria-hidden=true class=collapseSidebarButtonIcon_c4WT><g fill=#7a7a7a><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"/><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"/></g></svg></button></div></div></aside><main class=docMainContainer_namt><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_YAwJ"><div class=docItemContainer_Rv5Z><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_zCmv" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_JFrk><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><span class=breadcrumbs__link>Concepts</span><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>Node Traversals with NodeCaret</span></ul></nav><div class="tocCollapsible_O_Qc theme-doc-toc-mobile tocMobile_tjDr"><button type=button class="clean-btn tocCollapsibleButton_htYj">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Node Traversals with NodeCaret</h1></header>
<p>NodeCaret offers a unified and efficient way for traversing the document
tree, making it much easier to correctly implement traversals and avoid
edge cases around empty nodes and collapsed selections.</p>
<p>These new low-level functions were all designed to work together as a
fully featured relatively lightweight API to use in the core to
allow us to gradually address some edge cases and then simplify and shrink
the code. We expect higher-level utilities to be developed and shipped
in @lexical/utils or another module at a later date. The current overhead
should be less than 3kB in a production environment.</p>
<p>The NodeCaret API was introduced in lexical v0.25.0.</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id=concepts>Concepts<a href=#concepts class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>The core concept with <code>NodeCaret</code> is that you can represent any specific
point in the document by using an <code>origin</code> node, a <code>direction</code> that
points towards an adjacent node (<code>next</code> or <code>previous</code>), and a <code>type</code>
to specify whether the arrow points towards a sibling (<code>sibling</code>) or
towards a child (<code>child</code>).</p>
<p>All of these types have a <code>D</code> type parameter that must be a <code>CaretDirection</code>, so you
can not accidentally mix up <code>next</code> and <code>previous</code> carets. Many of them
also have a <code>T</code> type parameter that encodes the type of the <code>origin</code> node.</p>
<div class="theme-admonition theme-admonition-tip admonition_IZjC alert alert--success"><div class=admonitionHeading_uVvU><span class=admonitionIcon_HiR3><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>tip</div><div class=admonitionContent_bl22><p>The methods of a caret are designed to operate on nodes attached to the <code>origin</code>
in the designated direction, not the <code>origin</code> itself. For example, this code is
a no-op because it will attach a node to the <code>origin</code>, and then remove the node
that was just attached.<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_kX1v><pre tabindex=0 class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_AdAo><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// The origin is unaffected (other than being marked dirty)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">caret</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>insert</span><span class="token punctuation" style=color:#393A34>(</span><span class="token function" style=color:#d73a49>$createTextNode</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'no-op'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>remove</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_IZjC alert alert--warning"><div class=admonitionHeading_uVvU><span class=admonitionIcon_HiR3><svg viewBox="0 0 16 16"><path fill-rule=evenodd d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"/></svg></span>warning</div><div class=admonitionContent_bl22><p>Carets are immutable, and designed for low-level usage. There is no attempt
for carets to automatically update based on changes to the document
(this is a common source of bugs when working with <code>RangeSelection</code>).
Functions and methods that work with carets and are expected to change the
structure of the document will always return a possibly new caret.<p>The <code>origin</code> of a caret is the exact version of the object that it was
constructed with, all accessor methods on that origin will generally call
<code>origin.getLatest()</code> so the operations will see the latest version.</div></div>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id=nodecaret>NodeCaret<a href=#nodecaret class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p><code>NodeCaret</code> is any <code>SiblingCaret</code> or any <code>ChildCaret</code></p>
<ul>
<li>Typically constructed with <code>$getChildCaretOrSelf($getSiblingCaret(origin, direction))</code>
which returns a <code>ChildCaret</code> when the origin is an <code>ElementNode</code></li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_IZjC alert alert--success"><div class=admonitionHeading_uVvU><span class=admonitionIcon_HiR3><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>tip</div><div class=admonitionContent_bl22><p>This type does not include <code>TextPointCaret</code> or <code>TextPointCaretSlice</code>,
so you will not have to consider those edge cases when you see this
more specific type.</div></div>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id=siblingcaret>SiblingCaret<a href=#siblingcaret class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p><code>SiblingCaret</code> is a caret that points towards a sibling of the origin</p>
<ul>
<li>Constructed with <code>$getSiblingCaret(origin: LexicalNode, direction: CaretDirection)</code></li>
<li>The <code>next</code> direction points towards the right</li>
<li>The <code>previous</code> direction points towards the left</li>
</ul>
<table><thead><tr><th><th>→ direction: <code>'next'</code><th>← direction: <code>'previous'</code><tbody><tr><td><code>getParentAtCaret()</code><td><code>origin.getParent()</code><td><code>origin.getParent()</code><tr><td><code>getNodeAtCaret()</code><td><code>origin.getNextSibling()</code><td><code>origin.getPreviousSibling()</code><tr><td><code>insert(node)</code><td><code>origin.insertAfter(node)</code><td><code>origin.insertBefore(node)</code></table>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id=childcaret>ChildCaret<a href=#childcaret class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p><code>ChildCaret</code> is a caret that points towards the first or last child of the origin</p>
<ul>
<li>Constructed with <code>$getChildCaret(origin: ElementNode, direction: CaretDirection)</code></li>
<li>The <code>next</code> direction points towards the first child</li>
<li>The <code>previous</code> direction points towards the last child</li>
</ul>
<table><thead><tr><th><th>↘ direction: <code>'next'</code><th>↙ direction: <code>'previous'</code><tbody><tr><td><code>getParentAtCaret()</code><td><code>origin</code><td><code>origin</code><tr><td><code>getNodeAtCaret()</code><td><code>origin.getFirstChild()</code><td><code>origin.getLastChild()</code><tr><td><code>insert(node)</code><td><code>origin.splice(0, 0, node)</code><td><code>origin.append(node)</code></table>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id=pointcaret>PointCaret<a href=#pointcaret class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p><code>PointCaret</code> is any <code>TextPointCaret</code>, <code>SiblingCaret</code> or <code>ChildCaret</code>. This
type can be used to represent any point in the document that <code>PointType</code> can represent.</p>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id=textpointcaret>TextPointCaret<a href=#textpointcaret class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p><code>TextPointCaret</code> is basically a <code>SiblingCaret</code> with a <code>TextNode</code> origin and an <code>offset</code> property</p>
<ul>
<li>Constructed with <code>$getTextPointCaret(origin, direction, offset)</code></li>
<li>The <code>offset</code> property is an absolute index into the string</li>
<li>The <code>next</code> direction implies all text content after <code>offset</code></li>
<li>The <code>previous</code> direction implies all text content before <code>offset</code></li>
<li>All methods that are also present on <code>SiblingCaret</code> behave in the same way</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id=textpointcaretslice>TextPointCaretSlice<a href=#textpointcaretslice class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p><code>TextPointCaretSlice</code> is a wrapper for <code>TextPointCaret</code> that provides a signed <code>distance</code>.</p>
<ul>
<li>Constructed with <code>$getTextPointCaretSlice(caret, distance)</code></li>
<li>There are convenience methods like <code>removeTextSlice()</code> and <code>getTextContent()</code>,
so it's not generally necessary to know the implementation details here</li>
<li><code>Math.min(caret.offset, caret.offset + distance)</code> refers to the start offset of the slice</li>
<li><code>Math.max(caret.offset, caret.offset + distance)</code> refers to the end offset of the slice</li>
<li>The <code>direction</code> of the caret is generally ignored when working with a
<code>TextPointCaretSlice</code>, the slice is in absolute string coordinates</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_IZjC alert alert--info"><div class=admonitionHeading_uVvU><span class=admonitionIcon_HiR3><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>info</div><div class=admonitionContent_bl22><p>The property name <code>distance</code> was chosen because <code>length</code> and <code>size</code> are
commonly used on other data structures in JavaScript and Lexical, and they
are overwhelmingly non-negative. While most uses of <code>distance</code> are also
non-negative, in some contexts such as computer graphics it is not uncommon
to use
<a href=https://en.wikipedia.org/wiki/Signed_distance_function target=_blank rel="noopener noreferrer">Signed distance functions</a>
where the distance metric is signed.<p>In SDF terms, the subset of the space is <code>[offset, ∞)</code>. Any coordinate less
than the <code>offset</code> boundary is a negative distance; otherwise the distance is
non-negative.</div></div>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id=caretrange>CaretRange<a href=#caretrange class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p><code>CaretRange</code> contains a pair of <code>PointCaret</code> that are in the same direction. It
is equivalent in purpose to a <code>RangeSelection</code>, and is what you would generally
use for depth first traversals.</p>
<ul>
<li>Constructed with <code>$getCaretRange(anchor, focus)</code>, <code>$caretRangeFromSelection(selection)</code>,
or <code>$extendCaretToRange(anchor)</code></li>
<li>The <code>anchor</code> is the start of the range, generally where the selection originated,
and it is "anchored" in place because when a selection grows or shrinks only the
<code>focus</code> will be moved</li>
<li>The <code>focus</code> is the end of the range, where the blinking cursor is, it's the current
focus of the user</li>
<li>Anchor and focus must point in the same direction. The <code>anchor</code> points towards the first
node <em>in the range</em> and the focus points towards the first node <em>not in the range</em></li>
<li>The <code>getTextSlices()</code> method is essential to handle the literal edge cases where
the anchor and/or focus are a <code>TextPointCaret</code>. These edges are <em>not</em> included
in the default caret iteration of the <code>CaretRange</code>.</li>
</ul>
<div class="theme-admonition theme-admonition-warning admonition_IZjC alert alert--warning"><div class=admonitionHeading_uVvU><span class=admonitionIcon_HiR3><svg viewBox="0 0 16 16"><path fill-rule=evenodd d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"/></svg></span>warning</div><div class=admonitionContent_bl22><p>If you are iterating a <code>CaretRange</code> you must consider the <code>getTextSlices()</code>
separately, they are not included in the iteration. This is so you don't have
to consider <code>TextPointCaretSlice</code> at every step. They are literal edge cases
that can only be at the start and/or end and typically have special
treatment (splitting instead of removing, for example).</div></div>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id=traversal-strategies>Traversal Strategies<a href=#traversal-strategies class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id=adjacent-caret-traversals>Adjacent Caret Traversals<a href=#adjacent-caret-traversals class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>The lowest level building block for traversals with NodeCaret is the adjacent caret
traversal, which is supported directly by methods of NodeCaret.</p>
<p><code>getAdjacentCaret()</code> - Gets a <code>SiblingCaret</code> for the node attached to
<code>origin</code> in direction. If there is no attached node, it will return <code>null</code></p>
<p><code>getParentCaret(rootMode)</code> - Gets a <code>SiblingCaret</code> for the parent node
of <code>origin</code> in the same direction. If there is no parent node, or the parent
is a root according to <code>rootMode</code>, then it will return <code>null</code>. <code>rootMode</code>
may be <code>'root'</code> to only return <code>null</code> for <code>RootNode</code> or <code>'shadowRoot'</code> to
return <code>null</code> for <code>RootNode</code> or any <code>ElementNode</code> parent where
<code>isShadowRoot()</code> returns true</p>
<p><code>getChildCaret()</code> - Gets a <code>ChildCaret</code> for this origin, or <code>null</code> if the
origin is not an <code>ElementNode</code>. Will return <code>this</code> if the caret is already
a <code>ChildCaret</code></p>
<p>For example, iterating all siblings:</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_kX1v><pre tabindex=0 class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_AdAo><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// Note that NodeCaret&lt;D> already implements Iterable&lt;NodeCaret&lt;D>> in this</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// way, so this function is not very useful. You can just use startCaret as</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// the iterable.</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>*</span><span class="token generic-function function" style=color:#d73a49>$iterSiblings</span><span class="token generic-function generic class-name operator" style=color:#393A34>&lt;</span><span class="token generic-function generic class-name constant" style=color:#36acaa>D</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name keyword" style=color:#00009f>extends</span><span class="token generic-function generic class-name"> CaretDirection</span><span class="token generic-function generic class-name operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  startCaret</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> NodeCaret</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token constant" style=color:#36acaa>D</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> Iterable</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">SiblingCaret</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">LexicalNode</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token constant" style=color:#36acaa>D</span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Note that we start at the adjacent caret. The start caret</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// points away from the origin node, so we do not want to</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// trick ourselves into thinking that that origin is included.</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> caret </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> startCaret</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>getAdjacentCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    caret </span><span class="token operator" style=color:#393A34>!==</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    caret </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> caret</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>getAdjacentCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>yield</span><span class="token plain"> caret</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id=examples>Examples<a href=#examples class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>Given the following document tree, here are some examples of using the
adjacent node traversal:</p>
<p>Root</p>
<ul>
<li>Paragraph A<!-- -->
<ul>
<li>Text A1</li>
<li>Link A2<!-- -->
<ul>
<li>Text A3</li>
</ul>
</li>
<li>Text A4</li>
</ul>
</li>
<li>Paragraph B<!-- -->
<ul>
<li>Text B1</li>
</ul>
</li>
<li>Paragraph C</li>
</ul>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_kX1v><pre tabindex=0 class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_AdAo><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// The root does not have sibling nodes</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> carets </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token operator" style=color:#393A34>...</span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token function" style=color:#d73a49>$getRoot</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>expect</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">carets</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>toEqual</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_kX1v><pre tabindex=0 class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_AdAo><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// The adjacent node to a ChildNode is its first or last child</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// and is always a SiblingNode. It does not traverse deeper.</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> carets </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token operator" style=color:#393A34>...</span><span class="token function" style=color:#d73a49>$getChildCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token function" style=color:#d73a49>$getRoot</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// next starts at the first child</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>expect</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">carets</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>toEqual</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">paragraphA</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">paragraphB</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">paragraphC</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// previous starts at the last child</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> prevCarets </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token operator" style=color:#393A34>...</span><span class="token function" style=color:#d73a49>$getChildCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token function" style=color:#d73a49>$getRoot</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'previous'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>expect</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">prevCarets</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>toEqual</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">paragraphC</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'previous'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">paragraphB</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'previous'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">paragraphA</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'previous'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_kX1v><pre tabindex=0 class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_AdAo><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// The iteration starts at the node where the head of the "arrow"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// is pointing, which is away from the origin (the tail of the "arrow").</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> carets </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token operator" style=color:#393A34>...</span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">paragraphB</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>expect</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">carets</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>toEqual</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">paragraphC</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> prevCarets </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token operator" style=color:#393A34>...</span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">paragraphB</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'previous'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>expect</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">prevCarets</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>toEqual</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">paragraphA</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'previous'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id=depth-first-caret-traversals>Depth First Caret Traversals<a href=#depth-first-caret-traversals class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>The strategy to do a depth-first caret traversal is to use an adjacent caret
traversal and immediately use a <code>ChildCaret</code> any time that an <code>ElementNode</code>
origin is encountered. This strategy yields all possible carets, but each
ElementNode in the traversal may be yielded once or twice (a <code>ChildCaret</code> on
enter, and a <code>SiblingCaret</code> on leave). Allowing you to see whether an
<code>ElementNode</code> is partially included in the range or not is one of the
reasons that this abstraction exists.</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_kX1v><pre tabindex=0 class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_AdAo><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>*</span><span class="token generic-function function" style=color:#d73a49>$iterCaretsDepthFirst</span><span class="token generic-function generic class-name operator" style=color:#393A34>&lt;</span><span class="token generic-function generic class-name constant" style=color:#36acaa>D</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name keyword" style=color:#00009f>extends</span><span class="token generic-function generic class-name"> CaretDirection</span><span class="token generic-function generic class-name operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  startCaret</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> NodeCaret</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token constant" style=color:#36acaa>D</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> Iterable</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">NodeCaret</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token constant" style=color:#36acaa>D</span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>step</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">prevCaret</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> NodeCaret</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token constant" style=color:#36acaa>D</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>)</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>|</span><span class="token plain"> NodeCaret</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token constant" style=color:#36acaa>D</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Get the adjacent SiblingCaret</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> nextCaret </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> prevCaret</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>getAdjacentCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic>// If there is a sibling, try and get a ChildCaret from it</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">nextCaret </span><span class="token operator" style=color:#393A34>&&</span><span class="token plain"> nextCaret</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>getChildCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>||</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic>// Return the sibling if there is one</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      nextCaret </span><span class="token operator" style=color:#393A34>||</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic>// Return a SiblingCaret of the parent, if there is one</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      prevCaret</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>getParentCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'root'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// You may add an additional check here, usually some specific</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// caret to terminate the iteration with (such as the parent caret</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// of startCaret):</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>//</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>//  `caret !== null || caret.is(endCaret)`</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>//</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> caret </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>step</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">startCaret</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    caret </span><span class="token operator" style=color:#393A34>!==</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    caret </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>step</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">caret</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>yield</span><span class="token plain"> caret</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<p>Normally this type of iteration would be done from a <code>CaretRange</code>, where you
would specify a precise end caret (focus).</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_kX1v><pre tabindex=0 class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_AdAo><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token generic-function function" style=color:#d73a49>$iterCaretsDepthFirst</span><span class="token generic-function generic class-name operator" style=color:#393A34>&lt;</span><span class="token generic-function generic class-name constant" style=color:#36acaa>D</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name keyword" style=color:#00009f>extends</span><span class="token generic-function generic class-name"> CaretDirection</span><span class="token generic-function generic class-name operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  startCaret</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> NodeCaret</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token constant" style=color:#36acaa>D</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  endCaret</span><span class="token operator" style=color:#393A34>?</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> NodeCaret</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token constant" style=color:#36acaa>D</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> Iterable</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">NodeCaret</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token constant" style=color:#36acaa>D</span><span class="token operator" style=color:#393A34>>></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>$getCaretRange</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    startCaret</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Use the root as the default end caret, but you might choose</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// to use startCaret.getParentCaret('root') for example</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    endCaret </span><span class="token operator" style=color:#393A34>||</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token function" style=color:#d73a49>$getRoot</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> startCaret</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">direction</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<p>To get all nodes that are entirely selected between two carets:</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_kX1v><pre tabindex=0 class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_AdAo><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>*</span><span class="token generic-function function" style=color:#d73a49>$iterNodesDepthFirst</span><span class="token generic-function generic class-name operator" style=color:#393A34>&lt;</span><span class="token generic-function generic class-name constant" style=color:#36acaa>D</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name keyword" style=color:#00009f>extends</span><span class="token generic-function generic class-name"> CaretDirection</span><span class="token generic-function generic class-name operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  startCaret</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> NodeCaret</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token constant" style=color:#36acaa>D</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  endCaret</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> NodeCaret</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token constant" style=color:#36acaa>D</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>$getChildCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token function" style=color:#d73a49>$getRoot</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> startCaret</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">direction</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> Iterable</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">LexicalNode</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> seen </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token class-name operator" style=color:#393A34>&lt;</span><span class="token class-name">NodeKey</span><span class="token class-name operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> caret </span><span class="token keyword" style=color:#00009f>of</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>$getCaretRange</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">startCaret</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> endCaret</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">origin</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> caret</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token function" style=color:#d73a49>$isChildCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">caret</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      seen</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>add</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">origin</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>getKey</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>else</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token operator" style=color:#393A34>!</span><span class="token function" style=color:#d73a49>$isElementNode</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">origin</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>||</span><span class="token plain"> seen</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>has</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">origin</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>getKey</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic>// If the origin is an element and we have not seen it as a ChildCaret</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic>// then it was not entirely in the CaretRange</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token keyword" style=color:#00009f>yield</span><span class="token plain"> origin</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id=examples-1>Examples<a href=#examples-1 class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>Given the following document tree, here are some examples of using the
depth-first node traversal (with a <code>CaretRange</code>):</p>
<p>Root</p>
<ul>
<li>Paragraph A<!-- -->
<ul>
<li>Text A1</li>
<li>Link A2<!-- -->
<ul>
<li>Text A3</li>
</ul>
</li>
<li>Text A4</li>
</ul>
</li>
<li>Paragraph B<!-- -->
<ul>
<li>Text B1</li>
</ul>
</li>
<li>Paragraph C</li>
</ul>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_kX1v><pre tabindex=0 class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_AdAo><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// A full traversal of the document from root</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> carets </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token operator" style=color:#393A34>...</span><span class="token function" style=color:#d73a49>$getCaretRange</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Start with the arrow pointing towards the first child of root</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getChildCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token function" style=color:#d73a49>$getRoot</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// End when the arrow points away from root</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token function" style=color:#d73a49>$getRoot</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>expect</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">carets</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>toEqual</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getChildCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">paragraphA</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">   </span><span class="token comment" style=color:#999988;font-style:italic>// enter Paragraph A</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">textA1</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getChildCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">linkA2</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">       </span><span class="token comment" style=color:#999988;font-style:italic>// enter Link A2</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">textA3</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">linkA2</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">     </span><span class="token comment" style=color:#999988;font-style:italic>// leave Link A2</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">textA4</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">paragraphA</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// leave Paragraph A</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getChildCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">paragraphB</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">   </span><span class="token comment" style=color:#999988;font-style:italic>// enter Paragraph B</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">textB1</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">paragraphB</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// leave Paragraph B</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getChildCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">paragraphC</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">   </span><span class="token comment" style=color:#999988;font-style:italic>// enter Paragraph C</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>$getSiblingCaret</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">paragraphC</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'next'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// leave Paragraph C</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id=future-direction>Future Direction<a href=#future-direction class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>It's expected that higher-level abstractions will be built on top of this
outside of the core, either in @lexical/utils or a separate companion package.
This is just designed to be the lowest-level layer with a consistent and
type-safe interface. That sort of abstraction will probably look a little bit
like cheerio or jQuery, but for working with Lexical documents. It is not
expected that more abstractions will be added to the core.</p>
<p>In order to reduce code size and eliminate bugs, more of the core will be
refactored to use NodeCaret internally.</p>
<p>Once this happens, it's possible that the internal structure of PointType
and/or RangeSelection may change to accommodate NodeCaret, as it is more
resilient to document changes (only changes that directly affect the
origin node will "break" the point). A simple version of this would be to
create a caret any time that the point changes, and use that caret
as a fallback if the selection would otherwise be lost.</p>
<p>It may be the case that NodeCaret will become the lowest level API, working
directly with private LexicalNode/ElementNode internals. When/if that happens,
the methods on LexicalNode will remain for backwards compatibility,
but overriding them will not be supported. It isn't particularly safe to
override them as-is anyway, and these overrides are frequently the
root cause of bugs (e.g. parents that remove themselves after an operation
on a child, causing the point to be lost unless the caller was sophisticated
enough to store the array of parents).</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id=history>History<a href=#history class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>Before NodeCaret, Lexical's core API offered a relatively low-level DOM-like
interface for working with nodes and traversing them. It has accumulated
many functions over time for performing various kinds of traversals around
the tree (finding ancestors, children, depth, siblings, etc.), but most of
them are not implemented in a way that makes them easy to combine
efficiently, and many of them have edge cases that are difficult to avoid
and can't really be addressed without breaking compatibility.</p>
<p>Many of these functions also have a lot of edge cases, particularly around
assuming the reference nodes are inclusive. Many are also left-to-right
biased, don't offer an iterative version that can be aborted early or
consumed on the fly, etc.</p>
<p>Refactoring many of these to use something like <code>PointType</code> would almost
be sufficient for many of these use cases, but the representation of
that type is inefficient and error-prone as any mutation to the tree
requires that each point be manually recomputed. <code>PointType</code> is also
directionless, forcing a specific left-to-right bias into most APIs.
<code>RangeSelection</code> can be used in many cases because a direction can
be inferred from any two different points, but that collapses with
a single point. It's also impractical to use <code>RangeSelection</code>
concurrently with mutations due to the problems with <code>PointType</code>.</p>
<p>NodeCaret was born out of frustration with these APIs and a desire
to unify it all in a coherent way to simplify and reduce errors in
the core.</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id=terminology>Terminology<a href=#terminology class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id=caret>Caret<a href=#caret class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>The term Caret was chosen because it is concise and specific term
specific to a point in a text document. Lexical is "an extensible text editor
framework" so it makes sense that navigation in the document would use
terms relevant to text. Most other terms such as Cursor or Point
already have meanings in Lexical and/or are less specific.</p>
<p>See also:</p>
<ul>
<li><a href=https://developer.mozilla.org/en-US/docs/Glossary/Caret target=_blank rel="noopener noreferrer">Caret</a></li>
<li><a href=https://en.wikipedia.org/wiki/Caret_navigation target=_blank rel="noopener noreferrer">Caret navigation</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id=origin>Origin<a href=#origin class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>The origin is the reference node for a NodeCaret. Absolute coordinates
are determined by combining this origin node and an "arrow" that points
towards to where the adjacent node is (or could be). The "arrow" is
determined by the <code>direction</code> and <code>type</code> of the caret.</p>
<p>In a way this "arrow" is considered to be something like a unit vector
to indicate the direction, and adding it to an origin allows you to specify
an absolute location relative to that origin. Unlike the other coordinate
systems available in Lexical, it does not need recomputing whenever
siblings or a parent changes, so long as the origin node is still attached.</p>
<p>See also:</p>
<ul>
<li><a href=https://en.wikipedia.org/wiki/Origin_(mathematics) target=_blank rel="noopener noreferrer">Origin</a></li>
<li><a href=https://en.wikipedia.org/wiki/Unit_vector target=_blank rel="noopener noreferrer">Unit Vector</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id=childcaret--siblingcaret>ChildCaret / SiblingCaret<a href=#childcaret--siblingcaret class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>These were chosen because they match the existing methods on <code>ElementNode</code>
and <code>LexicalNode</code> (<code>getFirstChild</code>, <code>getNextSibling</code>, etc.)</p>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id=direction>Direction<a href=#direction class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p><code>'next'</code> and <code>'previous'</code> were chosen for direction mostly to match the
existing methods such as <code>getNextSibling()</code> that exist in DOM and in Lexical.
Using other words such as <code>'left'</code> and <code>'right'</code> would be ambiguous since
text direction can be bidirectional and already uses the terms left-to-right
and right-to-left.</p>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id=distance>Distance<a href=#distance class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>The property name <code>distance</code> was chosen for <code>TextPointCaretSlice</code> because
<code>length</code> and <code>size</code> are commonly used on other data structures in JavaScript
and Lexical, and they are overwhelmingly non-negative. While most uses of
<code>distance</code> are also non-negative, in some contexts such as computer graphics
it is not uncommon to use
<a href=https://en.wikipedia.org/wiki/Signed_distance_function target=_blank rel="noopener noreferrer">Signed distance functions</a>
where the distance metric is signed.</p>
<p>In SDF terms, the subset of the space is <code>[offset, ∞)</code>. Any coordinate less
than the <code>offset</code> boundary is a negative distance; otherwise the distance is
non-negative.</div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.com/QubitPi/lexical/tree/main/packages/lexical-website/docs/concepts/traversals.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_UohW aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_g62E"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href=/docs/concepts/dom-events><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Working with DOM Events</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/docs/concepts/updates><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Updates</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_TN1Q thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#concepts class="table-of-contents__link toc-highlight">Concepts</a><ul><li><a href=#nodecaret class="table-of-contents__link toc-highlight">NodeCaret</a><li><a href=#siblingcaret class="table-of-contents__link toc-highlight">SiblingCaret</a><li><a href=#childcaret class="table-of-contents__link toc-highlight">ChildCaret</a><li><a href=#pointcaret class="table-of-contents__link toc-highlight">PointCaret</a><li><a href=#textpointcaret class="table-of-contents__link toc-highlight">TextPointCaret</a><li><a href=#textpointcaretslice class="table-of-contents__link toc-highlight">TextPointCaretSlice</a><li><a href=#caretrange class="table-of-contents__link toc-highlight">CaretRange</a></ul><li><a href=#traversal-strategies class="table-of-contents__link toc-highlight">Traversal Strategies</a><ul><li><a href=#adjacent-caret-traversals class="table-of-contents__link toc-highlight">Adjacent Caret Traversals</a><li><a href=#examples class="table-of-contents__link toc-highlight">Examples</a><li><a href=#depth-first-caret-traversals class="table-of-contents__link toc-highlight">Depth First Caret Traversals</a><li><a href=#examples-1 class="table-of-contents__link toc-highlight">Examples</a></ul><li><a href=#future-direction class="table-of-contents__link toc-highlight">Future Direction</a><li><a href=#history class="table-of-contents__link toc-highlight">History</a><li><a href=#terminology class="table-of-contents__link toc-highlight">Terminology</a><ul><li><a href=#caret class="table-of-contents__link toc-highlight">Caret</a><li><a href=#origin class="table-of-contents__link toc-highlight">Origin</a><li><a href=#childcaret--siblingcaret class="table-of-contents__link toc-highlight">ChildCaret / SiblingCaret</a><li><a href=#direction class="table-of-contents__link toc-highlight">Direction</a><li><a href=#distance class="table-of-contents__link toc-highlight">Distance</a></ul></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Docs</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/docs/intro>Introduction</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Community</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://discord.gg/KmG4wQnnD9 target=_blank rel="noopener noreferrer" class=footer__link-item>Discord<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_awgD><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://stackoverflow.com/questions/tagged/lexicaljs target=_blank rel="noopener noreferrer" class=footer__link-item>Stack Overflow<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_awgD><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://twitter.com/lexicaljs target=_blank rel="noopener noreferrer" class=footer__link-item>Twitter<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_awgD><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>More</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://github.com/facebook/lexical target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_awgD><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Legal</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://opensource.facebook.com/legal/privacy/ target=_blank rel="noreferrer noopener" class=footer__link-item>Privacy<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_awgD><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://opensource.facebook.com/legal/terms/ target=_blank rel="noreferrer noopener" class=footer__link-item>Terms<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_awgD><use href=#theme-svg-external-link /></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2025 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>