<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-concepts/editor-state" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.8.0"><title data-rh=true>Editor State | Lexical</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://lexical.dev/docs/concepts/editor-state><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Editor State | Lexical"><meta data-rh=true name=description content="Why is it necessary?"><meta data-rh=true property=og:description content="Why is it necessary?"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://lexical.dev/docs/concepts/editor-state><link data-rh=true rel=alternate href=https://lexical.dev/docs/concepts/editor-state hreflang=en><link data-rh=true rel=alternate href=https://lexical.dev/docs/concepts/editor-state hreflang=x-default><link data-rh=true rel=preconnect href=https://YRGKJK6OMH-dsn.algolia.net crossorigin=anonymous><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://lexical.dev/docs/concepts/editor-state","name":"Editor State","position":1}]}</script><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="Lexical RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="Lexical Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=G-7C6YYBYBBT"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-7C6YYBYBBT",{})</script><link rel=search type=application/opensearchdescription+xml title=Lexical href=/opensearch.xml><link rel=stylesheet href=/assets/css/styles.ae5be95c.css><script src=/assets/js/runtime~main.05176213.js defer></script><script src=/assets/js/main.ab9576ef.js defer></script><body class=navigation-with-keyboard><svg xmlns=http://www.w3.org/2000/svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light",e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script>

<div style="display: none; text-align: center; background-color: white; color: black;" id=internaldocs-banner></div><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_G6ar href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/logo.svg alt=Lexical class="themedComponent_DHUr themedComponent--light_DIHH"><img src=/img/logo-dark.svg alt=Lexical class="themedComponent_DHUr themedComponent--dark_Bv2M"></div></a><a href=https://playground.lexical.dev/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">Playground</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/docs/intro>Docs</a><a class="navbar__item navbar__link" href=/docs/api/>API</a><a class="navbar__item navbar__link" href=/community>Community</a><a href=https://facebook.github.io/lexical-ios/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">iOS<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_awgD><use href=#theme-svg-external-link /></svg></a><a class="navbar__item navbar__link" href=/gallery>Gallery</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href=https://github.com/QubitPi/lexical target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_awgD><use href=#theme-svg-external-link /></svg></a><a href=https://github.com/facebook/lexical-ios target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">iOS GitHub<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_awgD><use href=#theme-svg-external-link /></svg></a><div class="toggle_OLSw colorModeToggle_Hg9V"><button class="clean-btn toggleButton_wYmb toggleButtonDisabled_vaDU" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_KEbZ lightToggleIcon_Sxwe"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_KEbZ darkToggleIcon_Yem1"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_KEbZ systemToggleIcon_txm5"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_bmvg><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_UyTV"><div class=docsWrapper_XLvK><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_z1FD" type=button></button><div class=docRoot_HciC><aside class="theme-doc-sidebar-container docSidebarContainer_e5ai"><div class=sidebarViewport_N8x0><div class=sidebar_vJCc><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_qiME"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/intro>Introduction</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs/getting-started/quick-start>Getting Started</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true href=/docs/concepts/editor-state>Concepts</a></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/docs/concepts/editor-state>Editor State</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/nodes>Nodes</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/node-replacement>Node Replacement</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/node-state>NodeState</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/key-management>Key Management</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/node-cloning>Node Cloning</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/listeners>Listeners</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/transforms>Node Transforms</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/commands>Commands</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/selection>Selection</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/read-only>Read Mode / Edit Mode</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/history>useHistory</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/serialization>Serialization & Deserialization</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/dom-events>Working with DOM Events</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/traversals>Node Traversals with NodeCaret</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts/updates>Updates</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs/packages/lexical>Packages</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs/react/>React</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs/collaboration/react>Collaboration</a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/faq>FAQ</a></ul></nav><button type=button title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_Ftvb"><svg width=20 height=20 aria-hidden=true class=collapseSidebarButtonIcon_c4WT><g fill=#7a7a7a><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"/><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"/></g></svg></button></div></div></aside><main class=docMainContainer_namt><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_YAwJ"><div class=docItemContainer_Rv5Z><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_zCmv" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_JFrk><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><span class=breadcrumbs__link>Concepts</span><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>Editor State</span></ul></nav><div class="tocCollapsible_O_Qc theme-doc-toc-mobile tocMobile_tjDr"><button type=button class="clean-btn tocCollapsibleButton_htYj">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Editor State</h1></header>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id=why-is-it-necessary>Why is it necessary?<a href=#why-is-it-necessary class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>With Lexical, the source of truth is not the DOM, but rather an underlying state model
that Lexical maintains and associates with an editor instance.</p>
<p>While HTML is great for storing rich text content it's often "way too flexible" when it comes to text editing.
For example the following lines of content will produce equal outcome:</p>
<div class="language-html codeBlockContainer_ZGJx theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_kX1v><pre tabindex=0 class="prism-code language-html codeBlock_TAPP thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_AdAo><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>i</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>b</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">Lexical</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>b</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>i</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>i</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>b</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">Lex</span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>b</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>b</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">ical</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>b</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>i</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>b</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>i</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">Lexical</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>i</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>b</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre></div></div>
<details class="details_B4FW alert alert--info details_SZgV" data-collapsed=true><summary>See rendered version!</summary><div><div class=collapsibleContent_VYua><div><i><b>Lexical</b></i><i><b>Lex</b><b>ical</b></i><b><i>Lexical</i></b></div></div></div></details>
<p>Of course, there are ways to normalize all these variants to a single canonical form, however this would require DOM manipulation and so re-rendering of the content. And to overcome this we can use Virtual DOM, or State.</p>
<p>On top of that it allows to decouple content structure from content formatting. Let's look at this example stored in HTML:</p>
<div class="language-html codeBlockContainer_ZGJx theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_kX1v><pre tabindex=0 class="prism-code language-html codeBlock_TAPP thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_AdAo><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>p</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">Why did the JavaScript developer go to the bar? </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>b</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">Because he couldn't handle his </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>i</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">Promise</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>i</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">s</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>b</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>p</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre></div></div>
<figure class=text--center><img src=/img/docs/state-formatting-html.drawio.svg alt="Nested structure of the HTML state"><figcaption>Nested structure of the HTML state because of the formatting</figcaption></figure>
<p>In contrast, Lexical decouples structure from formatting by offsetting this information to attributes. This allows us to have canonical document structure regardless of the order in which different styles were applied.</p>
<figure class=text--center><img src=/img/docs/state-formatting-lexical.png alt="Flat Lexical state"><figcaption>Flat Lexical state structure</figcaption></figure>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id=understanding-the-editor-state>Understanding the Editor State<a href=#understanding-the-editor-state class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>You can get the latest editor state from an editor by calling <code>editor.getEditorState()</code>.</p>
<p>Editor states have two phases:</p>
<ul>
<li>During an update they can be thought of as "mutable". See "Updating state" below to
mutate an editor state.</li>
<li>After an update, the editor state is then locked and deemed immutable from there on. This
editor state can therefore be thought of as a "snapshot".</li>
</ul>
<p>Editor states contain two core things:</p>
<ul>
<li>The editor node tree (starting from the root node).</li>
<li>The editor selection (which can be null).</li>
</ul>
<p>Editor states are serializable to JSON, and the editor instance provides a useful method
to deserialize stringified editor states.</p>
<p>Here's an example of how you can initialize editor with some state and then persist it:</p>
<div class="language-js codeBlockContainer_ZGJx theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_kX1v><pre tabindex=0 class="prism-code language-js codeBlock_TAPP thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_AdAo><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// Get editor initial state (e.g. loaded from backend)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token function-variable function" style=color:#d73a49>loadContent</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// 'empty' editor</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> value </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'{"root":{"children":[{"children":[],"direction":null,"format":"","indent":0,"type":"paragraph","version":1}],"direction":null,"format":"","indent":0,"type":"root","version":1}}'</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> value</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> initialEditorState </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>loadContent</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> editor </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>createEditor</span><span class="token punctuation" style=color:#393A34>(</span><span class="token spread operator" style=color:#393A34>...</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>registerRichText</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">editor</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> initialEditorState</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token spread operator" style=color:#393A34>...</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Handler to store content (e.g. when user submits a form)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token function-variable function" style=color:#d73a49>onSubmit</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword control-flow" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>saveContent</span><span class="token punctuation" style=color:#393A34>(</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>stringify</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">editor</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>getEditorState</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<p>For React it could be something like the following:</p>
<div class="language-jsx codeBlockContainer_ZGJx theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_kX1v><pre tabindex=0 class="prism-code language-jsx codeBlock_TAPP thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_AdAo><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> initialEditorState </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>loadContent</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> editorStateRef </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>useRef</span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword nil" style=color:#00009f>undefined</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>LexicalComposer</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>initialConfig</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f></span><br></span><span class=token-line style=color:#393A34><span class="token tag script language-javascript" style=color:#00009f>  </span><span class="token tag script language-javascript literal-property property" style=color:#36acaa>editorState</span><span class="token tag script language-javascript operator" style=color:#393A34>:</span><span class="token tag script language-javascript" style=color:#00009f> initialEditorState</span><br></span><span class=token-line style=color:#393A34><span class="token tag script language-javascript" style=color:#00009f></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">  </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>LexicalRichTextPlugin</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">  </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>LexicalOnChangePlugin</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>onChange</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript punctuation" style=color:#393A34>(</span><span class="token tag script language-javascript parameter" style=color:#00009f>editorState</span><span class="token tag script language-javascript punctuation" style=color:#393A34>)</span><span class="token tag script language-javascript" style=color:#00009f> </span><span class="token tag script language-javascript arrow operator" style=color:#393A34>=></span><span class="token tag script language-javascript" style=color:#00009f> </span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f></span><br></span><span class=token-line style=color:#393A34><span class="token tag script language-javascript" style=color:#00009f>    editorStateRef</span><span class="token tag script language-javascript punctuation" style=color:#393A34>.</span><span class="token tag script language-javascript property-access" style=color:#00009f>current</span><span class="token tag script language-javascript" style=color:#00009f> </span><span class="token tag script language-javascript operator" style=color:#393A34>=</span><span class="token tag script language-javascript" style=color:#00009f> editorState</span><span class="token tag script language-javascript punctuation" style=color:#393A34>;</span><span class="token tag script language-javascript" style=color:#00009f></span><br></span><span class=token-line style=color:#393A34><span class="token tag script language-javascript" style=color:#00009f>  </span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">  </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Button</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>label</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Save</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>onPress</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript punctuation" style=color:#393A34>(</span><span class="token tag script language-javascript punctuation" style=color:#393A34>)</span><span class="token tag script language-javascript" style=color:#00009f> </span><span class="token tag script language-javascript arrow operator" style=color:#393A34>=></span><span class="token tag script language-javascript" style=color:#00009f> </span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f></span><br></span><span class=token-line style=color:#393A34><span class="token tag script language-javascript" style=color:#00009f>    </span><span class="token tag script language-javascript keyword control-flow" style=color:#00009f>if</span><span class="token tag script language-javascript" style=color:#00009f> </span><span class="token tag script language-javascript punctuation" style=color:#393A34>(</span><span class="token tag script language-javascript" style=color:#00009f>editorStateRef</span><span class="token tag script language-javascript punctuation" style=color:#393A34>.</span><span class="token tag script language-javascript property-access" style=color:#00009f>current</span><span class="token tag script language-javascript punctuation" style=color:#393A34>)</span><span class="token tag script language-javascript" style=color:#00009f> </span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f></span><br></span><span class=token-line style=color:#393A34><span class="token tag script language-javascript" style=color:#00009f>      </span><span class="token tag script language-javascript function" style=color:#d73a49>saveContent</span><span class="token tag script language-javascript punctuation" style=color:#393A34>(</span><span class="token tag script language-javascript known-class-name class-name" style=color:#00009f>JSON</span><span class="token tag script language-javascript punctuation" style=color:#393A34>.</span><span class="token tag script language-javascript method function property-access" style=color:#d73a49>stringify</span><span class="token tag script language-javascript punctuation" style=color:#393A34>(</span><span class="token tag script language-javascript" style=color:#00009f>editorStateRef</span><span class="token tag script language-javascript punctuation" style=color:#393A34>.</span><span class="token tag script language-javascript property-access" style=color:#00009f>current</span><span class="token tag script language-javascript punctuation" style=color:#393A34>)</span><span class="token tag script language-javascript punctuation" style=color:#393A34>)</span><span class="token tag script language-javascript" style=color:#00009f></span><br></span><span class=token-line style=color:#393A34><span class="token tag script language-javascript" style=color:#00009f>    </span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript" style=color:#00009f></span><br></span><span class=token-line style=color:#393A34><span class="token tag script language-javascript" style=color:#00009f>  </span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>LexicalComposer</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre></div></div>
<p>Note that Lexical uses <code>initialConfig.editorState</code> only once (when it's being initialized) and passing different value later
won't be reflected in editor. See "Update state" below for proper ways of updating editor state.</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id=updating-state>Updating state<a href=#updating-state class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<div class="theme-admonition theme-admonition-tip admonition_IZjC alert alert--success"><div class=admonitionHeading_uVvU><span class=admonitionIcon_HiR3><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>tip</div><div class=admonitionContent_bl22><p>For a deep dive into how state updates work, check out <a href=https://dio.la/article/lexical-state-updates target=_blank rel="noopener noreferrer">this blog post</a> by Lexical contributor <a href=https://twitter.com/daniguardio_la target=_blank rel="noopener noreferrer">@DaniGuardiola</a>.</div></div>
<p>The most common way to update the editor is to use <code>editor.update()</code>. Calling this function
requires a function to be passed in that will provide access to mutate the underlying
editor state. When starting a fresh update, the current editor state is cloned and
used as the starting point. From a technical perspective, this means that Lexical leverages a technique
called double-buffering during updates. There's the "current" frozen editor state to represent what was
most recently reconciled to the DOM, and another work-in-progress "pending" editor state that represents
future changes for the next reconciliation.</p>
<p>Reconciling an update is typically an async process that allows Lexical to batch multiple synchronous
updates of the editor state together in a single update to the DOM – improving performance. When
Lexical is ready to commit the update to the DOM, the underlying mutations and changes in the update
batch will form a new immutable editor state. Calling <code>editor.getEditorState()</code> will then return the
latest editor state based on the changes from the update.</p>
<p>Here's an example of how you can update an editor instance:</p>
<div class="language-js codeBlockContainer_ZGJx theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_kX1v><pre tabindex=0 class="prism-code language-js codeBlock_TAPP thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_AdAo><span class=token-line style=color:#393A34><span class="token keyword module" style=color:#00009f>import</span><span class="token plain"> </span><span class="token imports punctuation" style=color:#393A34>{</span><span class="token imports">$getRoot</span><span class="token imports punctuation" style=color:#393A34>,</span><span class="token imports"> $getSelection</span><span class="token imports punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword module" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'lexical'</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword module" style=color:#00009f>import</span><span class="token plain"> </span><span class="token imports punctuation" style=color:#393A34>{</span><span class="token imports">$createParagraphNode</span><span class="token imports punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword module" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'lexical'</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Inside the `editor.update` you can use special $ prefixed helper functions.</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// These functions cannot be used outside the closure, and will error if you try.</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// (If you're familiar with React, you can imagine these to be a bit like using a hook</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// outside of a React function component).</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">editor</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>update</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Get the RootNode from the EditorState</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> root </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>$getRoot</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Get the selection from the EditorState</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> selection </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>$getSelection</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Create a new ParagraphNode</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> paragraphNode </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>$createParagraphNode</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Create a new TextNode</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> textNode </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>$createTextNode</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'Hello world'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Append the text node to the paragraph</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  paragraphNode</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>append</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">textNode</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Finally, append the paragraph to the root</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  root</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>append</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">paragraphNode</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>Another way to set state is <code>setEditorState</code> method, which replaces current state with the one passed as an argument.</p>
<p>Here's an example of how you can set editor state from a stringified JSON:</p>
<div class="language-js codeBlockContainer_ZGJx theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_kX1v><pre tabindex=0 class="prism-code language-js codeBlock_TAPP thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_AdAo><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> editorState </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> editor</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>parseEditorState</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">editorStateJSONString</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">editor</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>setEditorState</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">editorState</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id=state-update-listener>State update listener<a href=#state-update-listener class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>If you want to know when the editor updates so you can react to the changes, you can add an update
listener to the editor, as shown below:</p>
<div class="language-js codeBlockContainer_ZGJx theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_kX1v><pre tabindex=0 class="prism-code language-js codeBlock_TAPP thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_AdAo><span class=token-line style=color:#393A34><span class="token plain">editor</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>registerUpdateListener</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter punctuation" style=color:#393A34>{</span><span class="token parameter">editorState</span><span class="token parameter punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// The latest EditorState can be found as `editorState`.</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// To read the contents of the EditorState, use the following API:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  editorState</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>read</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Just like editor.update(), .read() expects a closure where you can use</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// the $ prefixed helper functions.</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id=when-are-listeners-transforms-and-commands-called>When are Listeners, Transforms, and Commands called?<a href=#when-are-listeners-transforms-and-commands-called class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>There are several types of callbacks that can be registered with the editor that are related to
updates of the Editor State.</p>
<table><thead><tr><th>Callback Type<th>When It's Called<tbody><tr><td>Update Listener<td>After reconciliation<tr><td>Mutation Listener<td>After reconciliation<tr><td>Node Transform<td>During <code>editor.update()</code>, after the callback finishes, if any instances of the node type they are registered for were updated<tr><td>Command<td>As soon as the command is dispatched to the editor (called from an implicit <code>editor.update()</code>)</table>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id=synchronous-reconciliation-with-discrete-updates>Synchronous reconciliation with discrete updates<a href=#synchronous-reconciliation-with-discrete-updates class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>While commit scheduling and batching are normally what we want, they can sometimes get in the way.</p>
<p>Consider this example: you're trying to manipulate an editor state in a server context and then persist it in a database.</p>
<div class="language-js codeBlockContainer_ZGJx theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_kX1v><pre tabindex=0 class="prism-code language-js codeBlock_TAPP thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_AdAo><span class=token-line style=color:#393A34><span class="token plain">editor</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>update</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// manipulate the state...</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>saveToDatabase</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">editor</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>getEditorState</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>toJSON</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>This code will not work as expected, because the <code>saveToDatabase</code> call will happen before the state has been committed.
The state that will be saved will be the same one that existed before the update.</p>
<p>Fortunately, the <code>discrete</code> option for <code>LexicalEditor.update</code> forces an update to be immediately committed.</p>
<div class="language-js codeBlockContainer_ZGJx theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_kX1v><pre tabindex=0 class="prism-code language-js codeBlock_TAPP thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_AdAo><span class=token-line style=color:#393A34><span class="token plain">editor</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>update</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// manipulate the state...</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token literal-property property" style=color:#36acaa>discrete</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>true</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>saveToDatabase</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">editor</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>getEditorState</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>toJSON</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id=cloning-state>Cloning state<a href=#cloning-state class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>Lexical state can be cloned, optionally with custom selection. One of the scenarios where you'd want to do it
is setting editor's state but not forcing any selection:</p>
<div class="language-js codeBlockContainer_ZGJx theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_kX1v><pre tabindex=0 class="prism-code language-js codeBlock_TAPP thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_AdAo><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// Passing `null` as a selection value to prevent focusing the editor</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">editor</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>setEditorState</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">editorState</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>clone</span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword null nil" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.com/QubitPi/lexical/tree/main/packages/lexical-website/docs/concepts/editor-state.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_UohW aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_g62E"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href=/docs/getting-started/devtools><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Developer Tools</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/docs/concepts/nodes><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Nodes</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_TN1Q thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#why-is-it-necessary class="table-of-contents__link toc-highlight">Why is it necessary?</a><li><a href=#understanding-the-editor-state class="table-of-contents__link toc-highlight">Understanding the Editor State</a><li><a href=#updating-state class="table-of-contents__link toc-highlight">Updating state</a><li><a href=#state-update-listener class="table-of-contents__link toc-highlight">State update listener</a><li><a href=#when-are-listeners-transforms-and-commands-called class="table-of-contents__link toc-highlight">When are Listeners, Transforms, and Commands called?</a><li><a href=#synchronous-reconciliation-with-discrete-updates class="table-of-contents__link toc-highlight">Synchronous reconciliation with discrete updates</a><ul><li><a href=#cloning-state class="table-of-contents__link toc-highlight">Cloning state</a></ul></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Docs</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/docs/intro>Introduction</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Community</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://discord.gg/KmG4wQnnD9 target=_blank rel="noopener noreferrer" class=footer__link-item>Discord<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_awgD><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://stackoverflow.com/questions/tagged/lexicaljs target=_blank rel="noopener noreferrer" class=footer__link-item>Stack Overflow<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_awgD><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://twitter.com/lexicaljs target=_blank rel="noopener noreferrer" class=footer__link-item>Twitter<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_awgD><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>More</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://github.com/facebook/lexical target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_awgD><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Legal</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://opensource.facebook.com/legal/privacy/ target=_blank rel="noreferrer noopener" class=footer__link-item>Privacy<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_awgD><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://opensource.facebook.com/legal/terms/ target=_blank rel="noreferrer noopener" class=footer__link-item>Terms<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_awgD><use href=#theme-svg-external-link /></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2025 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>